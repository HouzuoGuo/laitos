# Web service: Microsoft bot hook

## Introduction
Hosted by laitos [web server](https://github.com/HouzuoGuo/laitos/wiki/Daemon:-web-server), the web service is triggered
by Microsoft bot framework to offer access to all toolbox features via chat (such as Skype).

## Preparation
1. Sign up for a Microsoft account and visit [Microsoft Bot Framework](https://dev.botframework.com/).
2. Visit "My bots" and then [create a new bot](https://dev.botframework.com/bots/new)
3. Enter basic details such as name and description.
4. Think of a URL on your laitos server that will serve the bot, make the endpoint name difficult to guess and write it
   down into "Message endpoint". (e.g. `https://my-laitos-server.net/very-secret-microsoft-bot-hook`)
5. Click "Create Microsoft App ID and password" to automatically generate an app ID, be sure to note down the password
   as it will be filled into configuration soon.
6. Submit the form to complete registration of the new bot.

## Configuration
1. Place the following JSON data under JSON key `HTTPHandlers`:
    - String `MicrosoftBotEndpoint1` - URL location that will serve Microsoft bot; keep it a secret to yourself, and
      make it difficult to guess.
    - Object `MicrosoftBotEndpointConfig1` that comes with the following mandatory properties:
<table>
<tr>
    <th>Property</th>
    <th>Type</th>
    <th>Meaning</th>
</tr>
<tr>
    <td>ClientAppID</td>
    <td>string</td>
    <td>Bot's "app ID" that was automatically generated by Microsoft bot framework.</td>
</tr>
<tr>
    <td>ClientAppSecret</td>
    <td>strings</td>
    <td>Bot's "app secret password" that was automatically generated by Microsoft bot framework.</td>
</tr>
</table>

2. Follow [command processor](https://github.com/HouzuoGuo/laitos/wiki/Command-processor) to construct configuration for
   JSON key `HTTPBridges`.

Here is an example:
<pre>
{
    ...

    "HTTPHandlers": {
        ...
        
        "MicrosoftBotEndpoint1": "/very-secret-microsoft-bot-hook",
        "MicrosoftBotEndpointConfig1": {
            "ClientAppID": "abcde-fghijkl-mnopqrs-xyz012",
            "ClientAppSecret": "b54xni73chmixdd9as3288"
        },
        
        ...
    },

    ...
}
</pre>

## Run
The service is hosted by web server, therefore remember to [run web server](https://github.com/HouzuoGuo/laitos/wiki/Daemon:-web-server#run).

## Usage
Visit [My bots](https://dev.botframework.com/bots), and then click bot name to enter "Connect to channels" page. From
there, click a channel name such as "Skype" to add bot into Skype contacts.

Initiate a chat with bot and enter password PIN followed by toolbox command, a short while later the command result will
arrive in a chat reply.

## Tips
Make sure to choose a very secure URL for the endpoint, it is the only way to secure this web service!

If there are more than one bot to be served, construct configuration for `MicrosoftBotEndpoint2`,
`MicrosoftBotEndpoint3`, as well as `MicrosoftBotEndpointConfig2` and `MicrosoftBotEndpointConfig3`. A laitos server
may serve up to three bots.

Usage of HTTPS is mandatory in bot hook, your laitos web server must be serving HTTPS traffic using a valid TLS
certificate chain.